<footer class="mt-auto border-t border-white/10 bg-[#060a12]">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div>
        <div class="flex items-center gap-2 mb-3">
          <div class="w-8 h-8 bg-gradient-to-br from-secondary to-accent rounded-lg flex items-center justify-center font-bold text-primary text-sm">B</div>
          <span class="font-bold text-lg">BILYABITS<span class="text-secondary">-RAPI</span></span>
        </div>
        <p class="text-gray-400 text-sm">Open source REST API platform. Build, test, and deploy APIs effortlessly.</p>
      </div>
      <div>
        <h4 class="font-semibold text-sm mb-3 text-secondary">Quick Links</h4>
        <div class="space-y-2">
          <a href="/" class="block text-sm text-gray-400 hover:text-white transition">Home</a>
          <a href="/login" class="block text-sm text-gray-400 hover:text-white transition">Login</a>
          <a href="/register" class="block text-sm text-gray-400 hover:text-white transition">Register</a>
        </div>
      </div>
      <div>
        <h4 class="font-semibold text-sm mb-3 text-secondary">Socials</h4>
        <div class="space-y-2">
          <a href="<%= config.socials['repo-loc'] %>" target="_blank" class="block text-sm text-gray-400 hover:text-white transition">GitHub</a>
          <a href="<%= config.socials.facebook %>" target="_blank" class="block text-sm text-gray-400 hover:text-white transition">Facebook</a>
          <a href="<%= config.socials.telegram %>" target="_blank" class="block text-sm text-gray-400 hover:text-white transition">Telegram</a>
        </div>
      </div>
    </div>
    <div class="border-t border-white/10 mt-8 pt-6 text-center">
      <p class="text-gray-500 text-xs">&copy; <%= new Date().getFullYear() %> BILYABITS-RAPI by <%= config.ownerName %>. All rights reserved.</p>
    </div>
  </div>
</footer>
<script>
(function() {
  const toggle = document.getElementById('mobileToggle');
  const drawer = document.getElementById('sideDrawer');
  const overlay = document.getElementById('drawerOverlay');
  const closeBtn = document.getElementById('drawerClose');

  function openDrawer() {
    drawer.classList.remove('-translate-x-full');
    overlay.classList.remove('hidden');
    requestAnimationFrame(() => overlay.classList.remove('opacity-0'));
    document.body.style.overflow = 'hidden';
  }
  function closeDrawer() {
    drawer.classList.add('-translate-x-full');
    overlay.classList.add('opacity-0');
    setTimeout(() => overlay.classList.add('hidden'), 300);
    document.body.style.overflow = '';
  }

  toggle?.addEventListener('click', openDrawer);
  closeBtn?.addEventListener('click', closeDrawer);
  overlay?.addEventListener('click', closeDrawer);

  document.querySelectorAll('.drawer-dropdown-toggle').forEach(btn => {
    btn.addEventListener('click', () => {
      const content = btn.nextElementSibling;
      content.classList.toggle('hidden');
      btn.querySelector('svg').classList.toggle('rotate-180');
    });
  });

  const notifToggle = document.getElementById('notifToggle');
  const notifPanel = document.getElementById('notifPanel');
  if (notifToggle && notifPanel) {
    notifToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      notifPanel.classList.toggle('hidden');
    });
    document.addEventListener('click', (e) => {
      if (!notifPanel.contains(e.target) && e.target !== notifToggle && !notifToggle.contains(e.target)) {
        notifPanel.classList.add('hidden');
      }
    });

    const notifList = document.getElementById('notifList');
    const notifBadge = document.getElementById('notifBadge');
    const notifEmpty = document.getElementById('notifEmpty');
    const markAllBtn = document.getElementById('markAllRead');

    async function fetchNotifications() {
      try {
        const resp = await fetch('/api/notifications');
        if (!resp.ok) return;
        const data = await resp.json();
        const unread = data.filter(n => !n.is_read).length;
        if (unread > 0) {
          notifBadge.textContent = unread > 9 ? '9+' : unread;
          notifBadge.classList.remove('hidden');
        } else {
          notifBadge.classList.add('hidden');
        }
        if (data.length === 0) {
          notifEmpty.classList.remove('hidden');
          notifList.innerHTML = '';
          notifList.appendChild(notifEmpty);
          return;
        }
        notifEmpty.classList.add('hidden');
        const existingEmpty = notifList.querySelector('#notifEmpty');
        notifList.innerHTML = '';
        data.forEach(n => {
          const div = document.createElement('div');
          div.className = 'p-3 rounded-xl text-sm transition cursor-pointer ' + (n.is_read ? 'bg-white/5 text-gray-400' : 'bg-secondary/10 border border-secondary/20 text-white');
          div.innerHTML = `
            <div class="flex items-start justify-between gap-2">
              <div class="flex-1 min-w-0">
                <p class="font-semibold text-xs ${n.is_read ? 'text-gray-400' : 'text-secondary'}">${escapeHtml(n.title)}</p>
                <p class="text-xs mt-1 ${n.is_read ? 'text-gray-500' : 'text-gray-300'}">${escapeHtml(n.message)}</p>
                <p class="text-[10px] text-gray-500 mt-1">${timeAgo(n.created_at)}</p>
              </div>
              ${!n.is_read ? '<span class="w-2 h-2 bg-secondary rounded-full flex-shrink-0 mt-1"></span>' : ''}
            </div>
          `;
          if (!n.is_read) {
            div.addEventListener('click', () => markRead(n.id));
          }
          notifList.appendChild(div);
        });
      } catch(e) {}
    }

    async function markRead(id) {
      try {
        await fetch('/api/notifications/' + id + '/read', { method: 'POST' });
        fetchNotifications();
      } catch(e) {}
    }

    markAllBtn?.addEventListener('click', async () => {
      try {
        await fetch('/api/notifications/read-all', { method: 'POST' });
        fetchNotifications();
      } catch(e) {}
    });

    function escapeHtml(text) {
      const d = document.createElement('div');
      d.textContent = text;
      return d.innerHTML;
    }

    function timeAgo(dateStr) {
      const now = Date.now();
      const then = new Date(dateStr).getTime();
      const diff = Math.floor((now - then) / 1000);
      if (diff < 60) return 'just now';
      if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
      if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
      return Math.floor(diff / 86400) + 'd ago';
    }

    fetchNotifications();
    setInterval(fetchNotifications, 3000);
  }
})();
</script>
</body>
</html>
